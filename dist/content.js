(()=>{"use strict";class e{constructor(e){let t=document.createElement("div");t.className="video-hotkeys-overlay-wrapper",t.style.position="absolute",t.style.width="100%",t.style.top="0",t.style.marginTop="15%",t.style.zIndex="100",t.style.textAlign="center",t.style.display="none";let l=document.createElement("div");l.className="video-hotkeys-overlay",l.style.display="inline-block",l.style.background="rgba(0,0,0,0.5)",l.style.color="#fff",l.style.padding="10px 20px",l.style.borderRadius="3px",l.style.fontSize="175%",t.appendChild(l);let r=document.createTextNode("1.0x");l.appendChild(r),e.appendChild(t),this._wrapper=t,this._text=l}show(e){this._text.innerHTML=e,this._wrapper.style.display="",setTimeout((()=>{this._wrapper.style.display="none"}),500)}}e.volumeOffIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="48px" height="48px"><path d="M0 0h24v24H0z" fill="none"/><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>',e.volumeUpIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="48px" height="48px"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>';class t{constructor(){this.commands={play:this.playCommand(),speed:e=>this.speedCommand(e),fullscreen:this.fullscreenCommand(),danmu:this.nullCommand(),mute:this.muteCommand(),volume:e=>this.volumeCommand(e),skip:e=>this.skipCommand(e),seek:e=>this.seekCommand(e)}}$(e){var t,l;return null!==(l=null===(t=this.document)||void 0===t?void 0:t.querySelector(e))&&void 0!==l?l:null}nullCommand(){return{enabled:!1,call:()=>!1,status:()=>!1,message:()=>null}}playCommand(){return{enabled:!0,call:()=>{let e=this.playButton;return!!e&&(e.click(),!0)},status:()=>{var e;return!0!==(null===(e=this.videoHolder)||void 0===e?void 0:e.paused)},message:()=>null}}speedCommand(e){return{enabled:!0,call:()=>{let t=this.speedMenuItem;if(!t)return!1;let l=e?t.previousSibling:t.nextSibling;return!!(null==l?void 0:l.click)&&(l.click(),!0)},status:()=>{var e,t;return null!==(t=null===(e=this.videoHolder)||void 0===e?void 0:e.playbackRate)&&void 0!==t?t:-1},message:()=>{var e,t;return null!==(t=null===(e=this.speedMenuItem)||void 0===e?void 0:e.textContent)&&void 0!==t?t:null}}}fullscreenCommand(){return{enabled:!0,call:()=>{let e=this.fullscreenButton;return!!e&&(e.click(),!0)},status:()=>!1,message:()=>null}}muteCommand(){return{enabled:!0,call:()=>{let e=this.videoHolder;return!!e&&(e.muted=!e.muted,!0)},status:()=>{var e;return!0===(null===(e=this.videoHolder)||void 0===e?void 0:e.muted)},message:()=>{let t=this.videoHolder;return t?t.muted?e.volumeOffIcon:e.volumeUpIcon:null}}}volumeCommand(t){return{enabled:!0,call:()=>{let e=this.videoHolder;return!!e&&(e.muted&&(e.muted=!1),e.volume=Math.max(0,Math.min(1,e.volume+t)),!0)},status:()=>{var e,t;return null!==(t=null===(e=this.videoHolder)||void 0===e?void 0:e.volume)&&void 0!==t?t:-1},message:()=>{let t=this.videoHolder;return t?t.muted?e.volumeOffIcon:`${Math.round(100*t.volume)}%`:null}}}skipCommand(e){return{enabled:!0,call:()=>{let t=this.videoHolder;if(!t)return!1;let l=t.currentTime+t.playbackRate*e;return l!==t.currentTime&&(t.currentTime=Math.max(0,Math.min(t.duration,l)),!0)},status:()=>{var e,t;return null!==(t=null===(e=this.videoHolder)||void 0===e?void 0:e.currentTime)&&void 0!==t?t:-1},message:()=>null}}seekCommand(e){return{enabled:!0,call:()=>{let t=this.videoHolder;return!!t&&(t.currentTime=e*t.duration,!0)},status:()=>{let e=this.videoHolder;return e?e.currentTime/e.duration:null},message:()=>null}}}class l{static setVideoProvider(t){l._provider=t;let r=setInterval((()=>{if(!t.isReady)return;clearInterval(r);let i=t.overlayHolder;null!==i&&(l._overlay=new e(i)),t.setup(l.keyDownHandler),console.debug(`[video-hotkeys] loaded for ${t.name}`)}),300)}static keyDownHandler(e){var t,r,i,n;if("INPUT"===(null===(t=top.document.activeElement)||void 0===t?void 0:t.tagName)||"TEXTAREA"===(null===(r=top.document.activeElement)||void 0===r?void 0:r.tagName)||"SELECT"===(null===(i=top.document.activeElement)||void 0===i?void 0:i.tagName)||e.altKey||e.ctrlKey)return;let o=l.command(e.key);if(!o||!o.enabled||!o.call())return;let a=o.message();a&&(null===(n=l._overlay)||void 0===n||n.show(a)),e.preventDefault(),e.stopPropagation()}static command(e){var t;let r=null===(t=l._provider)||void 0===t?void 0:t.commands;if(!r)return null;if("0"<=e&&e<="9")return r.seek((e.charCodeAt(0)-"0".charCodeAt(0))/10);switch(e){case" ":return r.play;case"d":case"D":return r.danmu;case"f":case"F":return r.fullscreen;case"m":case"M":return r.mute;case"<":case">":return r.speed(">"==e);case"ArrowLeft":case"ArrowRight":return r.skip("ArrowRight"==e?5:-5);case"ArrowUp":case"ArrowDown":return r.volume("ArrowUp"==e?.05:-.05);default:return null}}}let r=[new class extends t{constructor(){super(...arguments),this.name="Bilibili",this.commands={play:this.playCommand(),speed:e=>this.speedCommand(e),fullscreen:this.fullscreenCommand(),danmu:{enabled:!0,call:()=>{let e=this.danmuCheckbox;return null!==e&&(e.click(),!0)},status:()=>{var e;return!0===(null===(e=this.danmuCheckbox)||void 0===e?void 0:e.checked)},message:()=>{let e=this.danmuCheckbox;return null===e?null:e.checked?"弹幕开启":"弹幕关闭"}},mute:this.muteCommand(),volume:e=>({enabled:!0,call:()=>{let t=this.videoHolder;if(!t)return!1;let l=Math.max(0,Math.min(1,t.volume+e)),r=this.$(".bilibili-player-video-volume-num");r&&(r.textContent=`${Math.round(100*l)}`);let i=this.$(".bilibili-player-video-volumebar .bui-bar-normal");i&&(i.style.transform=`scaleY(${l})`);let n=this.$(".bilibili-player-video-volumebar .bui-thumb");return n&&(n.style.transform=`translateY(-${Math.round(480*l)/10}px)`),t.volume=l,t.muted&&(t.muted=!1),!0},status:()=>{var e,t;return null!==(t=null===(e=this.videoHolder)||void 0===e?void 0:e.volume)&&void 0!==t?t:-1},message:()=>super.volumeCommand(0).message()}),skip:e=>this.skipCommand(e),seek:e=>this.seekCommand(e)}}get document(){return top.document}get isReady(){var e;return"complete"===top.document.readyState&&(!!(null===(e=this.videoHolder)||void 0===e?void 0:e.readyState)&&(!!this.playButton&&!!Array.from(top.document.querySelectorAll(".bilibili-player-video-panel-text .bilibili-player-video-panel-row")).every((e=>{var t;return"[完成]"===(null===(t=e.textContent)||void 0===t?void 0:t.substr(-4))}))))}get isPlayer(){return null!==top.document.querySelector("#bilibiliPlayer")}get videoHolder(){return this.$(".bilibili-player-video video")}get overlayHolder(){return this.$(".bilibili-player-video-wrap")}get playButton(){return this.$(".bilibili-player-video-btn-start button")}get fullscreenButton(){return this.$(".bilibili-player-iconfont-fullscreen-off")}get speedMenuItem(){return this.$(".bilibili-player-video-btn-speed-menu-list.bilibili-player-active")}get danmuCheckbox(){return this.$(".bilibili-player-video-danmaku-switch .bui-switch-input")}setup(e){top.document.onkeydown=e;let t=this.videoHolder;t.paused&&t.click(),this.commands.danmu.status()&&this.commands.danmu.call(),this.document.querySelectorAll(".bilibili-player-video-btn-volume button").forEach((e=>e.disabled=!0))}},new class extends t{constructor(){super(...arguments),this.name="PangziTV"}get document(){var e,t;return null!==(t=null===(e=top.document.querySelector(".videohtmlclass"))||void 0===e?void 0:e.contentDocument)&&void 0!==t?t:null}get isReady(){if("complete"!==top.document.readyState)return!1;let e=this.document;if(!e||"complete"!==e.readyState)return!1;let t=this.videoHolder;return!(!(null==t?void 0:t.readyState)||!this.playButton)}get isPlayer(){return null!==this.videoHolder}get videoHolder(){return this.$(".video-js video")}get overlayHolder(){return this.$(".video-js")}get playButton(){return this.$(".vjs-play-control")}get fullscreenButton(){return this.$(".vjs-fullscreen-control")}get speedMenuItem(){return this.$(".vjs-playback-rate .vjs-menu-item.vjs-selected")}setup(e){top.document.onkeydown=e;let t=this.document;if(!t)return;t.onkeydown=e;let l=t.querySelector(".vjs-playback-rate .vjs-menu-content");if(!l)return;l.innerHTML="";let r=[2,1.75,1.5,1.25,1,.75],i=(e,l)=>{let r=t.createAttribute(e);return r.value=l,r};for(let e of r){let r=t.createElement("li");r.className="vjs-menu-item",r.tabIndex=-1,r.attributes.setNamedItem(i("role","menuitemcheckbox")),r.attributes.setNamedItem(i("aria-live","polite")),r.attributes.setNamedItem(i("aria-disabled","false")),r.attributes.setNamedItem(i("aria-checked","false")),r.innerHTML=`${e}x <span class="vjs-control-text"> </span>`,1===e&&r.classList.add("vjs-selected"),l.appendChild(r),r.addEventListener("click",(()=>{var t;null===(t=this.speedMenuItem)||void 0===t||t.classList.remove("vjs-selected");let l=this.videoHolder;null!==l&&(l.playbackRate=e),r.classList.add("vjs-selected")}))}let n=t.querySelector(".vjs-playback-rate-value");null==n||n.addEventListener("click",(e=>e.stopPropagation()))}}];!function(){let e=setInterval((()=>{if("complete"!==top.document.readyState)return;clearInterval(e);let t=!1;for(let e of r)if(e.isPlayer){console.debug(`[video-hotkeys] detected ${e.name} player`),l.setVideoProvider(e),t=!0;break}t||console.debug("[video-hotkeys] no video player detected")}),300)}()})();